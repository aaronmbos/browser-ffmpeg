<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFmpeg x WASM</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss/dist/tailwind.min.css" rel="stylesheet">
    </link>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.3/flowbite.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <link rel="shortcut icon" type="image/jpg" href="favicon.ico" />
</head>

<body>
    <main class="container p-8">
        <h1 class="text-center py-4"><span class="font-bold text-5xl">FFmpeg</span><span
                class="text-xl mx-3">X</span><span class="text-4xl italic">WASM</span></h1>

        <label class="mx-auto w-1/2 block mb-2 font-medium text-gray-900 dark:text-white" for="uploader">Upload
            video file</label>
        <input
            class="block mx-auto w-1/2 text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400"
            id="uploader" type="file">
        <p class="text-center italic mt-6 hidden" id="run-msg">Running your command ...</p>
        <img class="my-5 mx-auto rounded hidden" height="500" width="500" id="thumbnail" />
    </main>
</body>
<script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ log: true });
    const transcode = async ({ target: { files } }) => {
        const msg = document.getElementById('run-msg');
        msg.classList.remove('hidden');

        const { name } = files[0];

        await ffmpeg.load();
        ffmpeg.FS('writeFile', name, await fetchFile(files[0]));

        // ffmpeg -i input.mp4 -ss 00:00:03 -vframes 1 -q:v 2 output.jpg
        await ffmpeg.run('-i', name, '-ss', '00:00:03', '-vframes', '1', '-q:v', '2', 'output.jpg');

        const data = ffmpeg.FS('readFile', 'output.jpg');

        msg.classList.toggle('hidden');

        const img = document.getElementById('thumbnail');
        img.classList.toggle('hidden');
        img.src = URL.createObjectURL(new Blob([data.buffer], { type: 'image/jpeg' }));
    }
    document.getElementById('uploader').addEventListener('change', transcode);
</script>

</html>
